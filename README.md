# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на три слоя, основываясь на парадигме MVP: 
- слой данных, отвечает за все манипуляции с данными (хранение, изменение, преобразование)
- слой отображения, отвечает все за отображение всех элементов, которые видит пользователь на странице 
- брокер событий - является связующим звеном между слоем модели данных и слоем отображения.

### Базовый код

#### Класс Api
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос, методу также необходимо передать эндпоинт запроса. Метод возвращает промис с объектом, переданным от сервера
- `post` - принимает объект с данными переданными в формате JSON в теле запроса, методу также необходимо передать эндпоинт запроса для отправки на сервер. По умолчанию выполняется `POST` запрос, метод запроса также можно переопределить - передать необходимый метод запроса в параметры.

#### Класс EventEmitter
Брокер событий связывает слой модели данных и слой отображения, позволяет самостоятельно генерировать события и подписываться на них. Класс реализуется в презентере для обработки событий.  
Основные методы:
- `on` - установка обработчика на события
- `emit` - инициализация события с данными
- `trigger` - создает функцию коллбек, которая генерирует событие при вызове

#### Класс Component
Абстрактный базовый класс для всех элементов слоя представления. Имеет единственный метод render, который генерирует или обновляет необходимый компонент разметки.

```
interface IComponent<T>{
    render(data?: Partial<T>): HTMLElement;
}
```

### Модель данных

#### Класс ProductsData
Класс отвечает за хранение и работу с данными карточки товара.   
В полях класса хранится массив объектов товаров, id товара, выбранного для просмотра в модальном окне (preview) и экземпляр класса `EventEmitter` для инициации событий при изменении данных.  
Класс имеет метод, который возвращает карточку по ее id, также класс имеет сеттеры и геттеры для сохранения и получения данных из полей класса.

```
export interface IProductsData {
    items: IProduct[];
    preview: string | null; 
    events: IEvents;
    getProduct(productId: string): IProduct;
}
```

#### Класс CartData
Класс отвечает за хранение данных в корзине и логику работы с этими данными.   
В полях класса - массив объектов товаров, экземпляр класса `EventEmitter`. Класс имеет методы работы с данными: добавление продукта в корзину, зачистка корзины, получение количества товаров в корзине, подсчет стоимости товаров в корзине, проверка наличия товара в корзине, удаление товара из корзины, а также геттеры и сеттеры для сохранения и получения данных из поля класса.

```
export interface ICartData {
    products: IProduct[];
    events: IEvents;
    addProduct(product: IProduct): void;
    clear(): void;
    getNumberOfProducts(): number;
    getTotalPrice(): number;
    hasProduct(productId: string): boolean;
    removeProduct(productId: string): void;
}
```

#### Класс Order
Класс отвечает за хранение и работу с данными товаров в корзине и данными пользователя, которые необходимо для отправки заказа на сервер.
Класс имеет метод проверки валидации корзины - если в корзине находится только бесценный товар (стоимость заказа равна нулю), то дальнейшее оформление заказа невозможно. Также класс может валидировать корректность введенных данных покупателя.

```
export interface IOrder {
    products: IProduct[];
    payment: TPayment;
    email: TEmail;
    phone: TPhone;
    address: string;
    totalPrice: number;
    events: IEvents;
    error: string;
    checkPriceValidation(products: IProduct[]): boolean;
    checkAdress(data: Record<string, string>): boolean;
    checkPhone(data: Record<string, string>): boolean;
    checkMail(data: Record<string, string>): boolean;
}
```

#### Используемые типы данных

```
export type TPayment = 'online' | 'offline';

type TEmail = string;
type TPhone = string;
```


### Слой отображения

#### Класс Page
Класс  отвечает за отображение главной страницы сервиса. В конструктор класса передается DOM элемент контейнера главной страницы.  
В полях класса находятся все элементы главной страницы. Также класс имеет метод render, унаследованный от класса Component.  
  
Поля класса: 
- products: HTMLElement[];
- numberOfProductsInCart: number;


#### Класс Modal
Родительский класс для всех модальных окон. Реализует отображение модального окна, содержит методы открытия и закрытия модального окна. В конструктор принимает DOM элемент темплейта модального окна и экземпляр класса `EventEmitter`.
Класс также имеет метод render, наследованный от класса Component.  
  
Поля класса:
- modal: HTMLTemplateElement;
- events: IEvents;
  
Методы класса:
- open(): void;
- close(): void;


#### Класс ProductCard
Класс отвечает за отображение карточки. В конструктор класса передается DOM элемент темплейта карточки, что позволяет формировать карточки разных вариантов верстки (на главной странице, в модальном окне, в корзине). В конструкторе класса определяются все DOM элементы, необходимые для отрисовки карточек товаров, устанавливаются слушатели на все интерактивные элементы, при взаимодействии с этими слушателями будут генерироваться соответствующие события.
Класс также имеет метод render, наследованный от класса Component, методы open и close, наследованные от класса Modal.

Поля класса:
- name: HTMLButtonElement
- image: HTMLImageElement
- category: HTMLSpanElement
- description: HTMLParagraphElement
- price: HTMLSpanElement
- id: string
- basketItemIndex: HTMLSpanElement
- addToCartButton: HTMLButtonElement
- deleteButton: HTMLButtonElement
- events: IEvents
  
Методы класса:
- addToCart(): void - добавление в корзину - меняет нейминг кнопки "добавить в корзину"
- removeFromCart(): void - удаление из корзины - выполняет удаление элемента после нажатия на кнопку урны в корзине


#### Класс Cart
Класс предназначен для отображения модального окна с корзиной, расширяет класс Modal. В конструктор принимает DOM элемент темплейта модального окна и экземпляр класса `EventEmitter`. В конструкторе класса определяются DOM элементы, необходимые для отрисовки корзины, устанавливаются слушатель на кнопку оформления заказа, но только после проверки общей стоимости товаров. Если стоимость товаров равна нулю, кнопка оформления заказа неактивна.
Класс также имеет метод render, наследованный от класса Component, методы open и close, наследованные от класса Modal. 

Поля класса:
- productsContainer: HTMLElement[]
- buttonCreateOrder: HTMLButtonElement
- totalPrice: number
- allowOrder: boolean
- events: IEvents
  
Методы класса:
- clear(): void - метод зачистки корзины после успешно оформленного заказа


#### Класс ModalWithForm
Класс предназначен для отображения модальных окон с формами (адрес, контакты покуапателя), также расширяет класс Modal. В конструктор принимает DOM элемент темплейта модального окна, что дает возможность отрисовывать различные варианты модальных окон с формами, и экземпляр класса `EventEmitter`.  
В конструкторе класса определяются DOM элементы, необходимые для отрисовки модального окна, также класс имеет методы: установки валидации формы для корректного отображения кнопки оформления заказа, показа ошибок валидации, зачистки формы после закрытия модального окна, изменения состояния кнопок способа оплаты (нал/ безнал).
Класс также имеет метод render, наследованный от класса Component, методы open и close, наследованные от класса Modal.

Поля класса:
- onlinePaymentButton: HTMLButtonElement
- offlinePaymentButton: HTMLButtonElement
- form: HTMLFormElement
- inputs: NodeListOf```<HTMLInputElement>```
- submitButton: HTMLButtonElement
- formError: HTMLSpanElement
- events: IEvents;
  
Методы класса:
- switchPaymentButtonState(buttonName: string): void
- setValidity(): void
- showError(errorMessage: string): void
- hideError(): void
- close(): void - расширяет родительский метод, добавляя туда зачистку формы после закрытия модального окна


#### Класс ModalSuccessOrder
Класс предназначен для отображения модального окна с надписью успешного оформления заказа и стоимостью заказа. Данный класс расширяет класс Modal. В конструктор принимает DOM элемент темплейта модального окна и экземпляр класса `EventEmitter`.  
В конструкторе класса определяется DOM элемент, необходимый для отображения итоговой стоимости заказа.  
Класс также имеет метод render, наследованный от класса Component, методы open и close, наследованные от класса Modal.

Поля класса:
- price: HTMLParagraphElement
- events: IEvents


### Слой коммуникации

#### Класс WebLarekApi
Принимает в конструктор экземпляр класса Api (интерфейс IApi) и предоставляет методы, которые реализуют взаимодействие с сервером.

```
export interface IApi {
    baseUrl: string;
    get<T>(uri: string): Promise<T>;
    post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}


export interface IWebLarekApi {
	baseApi: IApi;
	getProducts(): IProduct[];
	getProduct(productId: string): IProduct;
	createOrder(): void;
}
```

## Взаимодействие компонентов

*Список всех событий, которые могут генерироваться в системе:*  

- `cart: open` - открытие модального окна корзины
- `cart: close` - закрытие модального окна корзины
- `product: addToCart` - добавление продукта в корзину
- `product: removeFromCart` - удаление продукта из корзины
- `productModal: open` - открытие модального окна с карточкой продукта
- `productModal: close` - закрытие модального окна с карточкой продукта
- `paymentButton: switch`- переключение кнопки выбора оплаты (нал/ безнал)
- `adressModal: open` - открытие модального окна с формой ввода адреса
- `adressModal: close` - закрытие модального окна с формой ввода адреса
- `adressModal: validation` - событие, сообщающее о необходимости валидации модального окна с формой ввода адреса
- `contactsModal: open` - открытие модального окна с формой контактов покупателя
- `contactsModal: close` - закрытие окна с формой контактов покупателя
- `contactsModal: validation` - событие, сообщающее о необходимости валидации модального окна с формой контактов покупателя
- `input: adress` - изменение данных в форме оставления адреса
- `input: phone` - изменение данных в форме оставления телефона
- `input: mail` - изменение данных в форме оставления почты
- `submit: contacts form` - сохранение адреса пользователя при оформлении заказа
- `submit: order form` - сохранение контактов пользователя при оформлении заказа
- `successOrderModal: close` - закрытие модального окна с оповещением об успешном оформлении заказа 
- `order: created` - событие, сообщающее о создании заказа и необходимости зачистки корзины, открытия модального окна с оповещением об успешном оформлении заказа