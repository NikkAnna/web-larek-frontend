# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на три слоя, основываясь на парадигме MVP: 
- слой данных, отвечает за все манипуляции с данными (хранение, изменение, преобразование)
- слой отображения, отвечает все за отображение всех элементов, которые видит пользователь на странице 
- брокер событий - является связующим звеном между слоем модели данных и слоем отображения.

### Базовый код

#### Класс Api
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос, методу также необходимо передать эндпоинт запроса. Метод возвращает промис с объектом, переданным от сервера
- `post` - принимает объект с данными переданными в формате JSON в теле запроса, методу также необходимо передать эндпоинт запроса для отправки на сервер. По умолчанию выполняется `POST` запрос, метод запроса также можно переопределить - передать необходимый метод запроса в параметры.

#### Класс EventEmitter
Брокер событий связывает слой модели данных и слой отображения, позволяет самостоятельно генерировать события и подписываться на них. Класс реализуется в презентере для обработки событий.  
Основные методы:
- `on` - установка обработчика на события
- `emit` - инициализация события с данными
- `trigger` - создает функцию коллбек, которая генерирует событие при вызове

#### Класс Component
Абстрактный базовый класс для всех элементов слоя представления. Имеет метод render, который генерирует или обновляет необходимый компонент разметки, методы для присвоения текстового содержимого, изображения элементу, смены состояния элемента.

```
interface IComponent<T>{
    render(data?: Partial<T>): HTMLElement;
    setText(element: HTMLElement, value: unknown): void;
    setImage(element: HTMLImageElement, src: string, alt?: string): void;
    setDisabled(element: HTMLElement, state: boolean): void;
}
```

### Модель данных

#### Класс ProductsData
Класс отвечает за хранение и работу с данными карточки товара.   
В полях класса хранится массив объектов товаров, id товара, выбранного для просмотра в модальном окне (preview) и экземпляр класса `EventEmitter` для инициации событий при изменении данных.  
Класс имеет методы: получение карточки товара по ее id, получение массива товаров, установка превью для карточки по ее id, определение массива товаров

```
export interface IProductsData {
    items: IProduct[];
    preview: string | null;
    getProduct(productId: string): IProduct;
    getProducts(): IProduct[] | undefined;
    setProducts(products: IProduct[]): void;
    setPreview(productId: string): void;
    getPreview(): string | null;
    setIsInCart(productId: string, value: boolean): void;
}
```

#### Класс CartData
Класс отвечает за хранение данных в корзине и логику работы с этими данными.
В полях класса - массив объектов товаров, экземпляр класса `EventEmitter`. Класс имеет методы работы с данными: добавление продукта в корзину, зачистка корзины, получение количества товаров в корзине, подсчет стоимости товаров в корзине, проверка наличия товара в корзине, удаление товара из корзины, получение массива товаров, находящихся в корзине. Класс имеет метод проверки валидации корзины - если в корзине находится только бесценный товар (стоимость заказа равна нулю), то дальнейшее оформление заказа невозможно.

```
export interface ICartData {
    getItemBasketIndex(productId: string): number;
    addProduct(product: IProduct): void;
    removeProduct(productId: string): void;
    getProductsInCart(): IProduct[];
    getNumberOfProducts(): number;
    hasProduct(productId: string): boolean;
    getTotalPrice(): number;
    clear(): void;
    validateTotalPrice(): boolean;
}
```

#### Класс Order
Класс отвечает за хранение и работу с данными товаров в корзине и данными пользователя, которые необходимо для отправки заказа на сервер.
Также класс может валидировать корректность введенных данных покупателя.

```
export interface IOrder {
    getOrder(): IOrder;
    setProducts(products: IProduct[]): void;
    setPayment(data: TPayment): void;
    setEmail(data: TEmail): void;
    setPhone(data: TPhone): void;
    setAddress(data: string): void;
    setError(data: string): void;
    getError(): string;
    setValid(valid: boolean): void;
    getValid(): boolean;
    setTotalPrice(data: number): void;
    validateContacts(): boolean;
    validateAddress(): boolean;
    clear(): void;
}
```

#### Используемые типы данных

```
export type TPayment = 'online' | 'offline';

type TEmail = string;
type TPhone = string;

type TCategory =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скил';
```


### Слой отображения

#### Класс Page
Класс  отвечает за отображение главной страницы сервиса. В конструктор класса передается DOM элемент контейнера главной страницы.  
В полях класса находятся все элементы главной страницы. Также класс имеет метод render, унаследованный от класса Component.  
  
Поля класса: 
- productsContainer: HTMLElement;
- productsInCart: HTMLElement;
- wrapper: HTMLElement;
- events: IEvents;
- cartButton: HTMLElement;


#### Класс Modal
Класс модального окна, реализует отображение всех модальных окон в проекте, отображает модальные окна с разным содержимым. Содержит методы открытия и закрытия модального окна. В конструктор принимает DOM элемент модального окна и экземпляр класса `EventEmitter`.
Класс также имеет метод render, наследованный от класса Component.  
  
Поля класса:
- modal: HTMLElement;
- events: IEvents;
- closeModalButton: HTMLButtonElement;
  
Методы класса:
- open(): void;
- close(): void - в этом методе также происходит очистка содержимого, которое показывалось в контейнере Modal


#### Класс ProductCard
Класс отвечает за отображение карточки. В конструктор класса передается DOM элемент темплейта карточки, что позволяет формировать карточки разных вариантов верстки (на главной странице, в модальном окне, в корзине). В конструкторе класса определяются все DOM элементы, необходимые для отрисовки карточек товаров, устанавливаются слушатели на все интерактивные элементы, при взаимодействии с этими слушателями будут генерироваться соответствующие события.
Класс также имеет метод render, наследованный от класса Component.

Поля класса:
- _name: HTMLElement
- _image: HTMLImageElement
- _category: HTMLSpanElement
- _description: HTMLParagraphElement
- _price: HTMLSpanElement
- prosuctId: string
- _basketItemIndex: HTMLSpanElement
- addToCartButton: HTMLButtonElement
- deleteButton: HTMLButtonElement
- galleryCardButton: HTMLButtonElement
- events: IEvents;
- _isInCart: boolean;


#### Класс Cart
Класс предназначен для отображения контента модального окна с корзиной. В конструктор принимает DOM элемент темплейта модального окна и экземпляр класса `EventEmitter`. В конструкторе класса определяются DOM элементы, необходимые для отрисовки корзины, устанавливаются слушатель на кнопку оформления заказа, но только после проверки общей стоимости товаров. Если стоимость товаров равна нулю, кнопка оформления заказа неактивна.
Класс также имеет метод render, наследованный от класса Component.

Поля класса:
- _productsContainer: HTMLElement;
- _buttonCreateOrder: HTMLButtonElement;
- _totalPrice: HTMLSpanElement;
- _allowOrder: boolean;
- events: IEvents;


#### Класс ModalForm
Класс предназначен для отображения контента двух модальных окон с формами (адрес, контакты покуапателя). В конструктор принимает DOM элемент темплейта модального окна, что дает возможность отрисовывать различные варианты модальных окон с формами, и экземпляр класса `EventEmitter`.  
В конструкторе класса определяются DOM элементы, необходимые для отрисовки модального окна, также класс имеет метод зачистки выбора кнопки оплаты после закрытия модального окна с оформлением заказа.
Класс также имеет метод render, наследованный от класса Component.

Поля класса:
- onlinePaymentButton: HTMLButtonElement
- offlinePaymentButton: HTMLButtonElement
- submitButton: HTMLButtonElement
- formError: HTMLSpanElement
- events: IEvents;
- formName: string;
- addressInput: HTMLInputElement;
- phoneInput: HTMLInputElement;
- emailInput: HTMLInputElement;
  
Методы класса:
- resetPaymentButton(): void;


#### Класс ModalSuccess
Класс предназначен для отображения модального окна с надписью успешного оформления заказа и стоимостью заказа. Данный класс расширяет класс Modal. В конструктор принимает DOM элемент темплейта модального окна и экземпляр класса `EventEmitter`.  
В конструкторе класса определяется DOM элемент, необходимый для отображения итоговой стоимости заказа.  
Класс также имеет метод render, наследованный от класса Component.

Поля класса:
- _price: HTMLParagraphElement;
- events: IEvents;
- buttonCloseSuccessModal: HTMLButtonElement;


### Слой коммуникации

#### Класс WebLarekApi
Принимает в конструктор экземпляр класса Api (интерфейс IApi) и предоставляет методы, которые реализуют взаимодействие с сервером.

```

export interface IWebLarekApi {
	baseApi: Api;
	getProducts(): Promise<IProduct[]>;
	getProduct(productId: string): Promise<IProduct>;
	createOrder(data: IOrder): Promise<IOrder>;
}

```

## Взаимодействие компонентов

*Список всех событий, которые могут генерироваться в системе:*  

- `initialData: loaded` - получаем данные с сервера при загрузке главной страницы, отрисовываем их с помощью класса отображения Page
- `product: selected` - при клике на карточку передает в модель данных объект карточки, на которую кликнули
- `preview: changed` - передает данные товара из модели в отображение для отрисовки превью переданной карточки
- `productCartButton:changed` - при клике на кнопку "в корзину" или удалить из корзины" передаем данные о том, что пользователь хочет изменить состав корзины
- `cartProductsCounter:changed` - при изменении кол-ва товаров в корзине, передаем информацию отображению и меняем счетчик товаров на главной странице
- `deleteButton:selected` - при клике на кнопку урны в корзине передаем информацию в модель о том, что товар удалили из корзины
- `cart: change` - при изменении кол-ва товаров в корзине перерисовываем отображение корзины
- `create order` - при клике на кнопку "оформить заказ" отрисовываем отображение формы с вводом адреса и выбором способа оплаты
- `orderFormValidity:changed`, `contactsFormValidity:changed` - проверяем валидацию формы при ее заполнении пользователем и меняем отображение кнопки "далее"/"оплатить" в зависимости от состояния валидации формы
- `order:submi`t` - при клике на кнопку оформить отображаем следующую модалку с формами ввода телефона и почты
- `contacts:submit` - собираем данные по заказу и отправляем их на сервер
- `order:success` - при успешной отправке данных на сервер, отрисовываем модалку с успешным оформлением заказа
